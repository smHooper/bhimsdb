<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta name="viewport" content="width=device-width,height=device-height, user-scalable=no" />
	<title>DENA BHIMS dashboard</title>
	<!--jquery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	
	<!-- bootstrap -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css"/>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>

	<!--fonts -->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

	<!-- font awesome --> 
	<link href="packages/fontawesome/css/all.min.css" rel="stylesheet">

	<!-- Leaflet -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>

	<!-- chart.js -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.2.0/chart.min.js"></script>

	<link rel="stylesheet" href="css/bhims.css">
	<link rel="stylesheet" href="css/bhims-dashboard.css">

</head>

<body>
	 <!-- loading indicator should be hidden and will only be shown when loading data -->
	<div id="loading-indicator-background" class="modal-background modal-background-light hidden" ></div>
	<div id="loading-indicator" class="hidden"></div>


	<nav class="bhims-header-menu">
		<div class="header-menu-item-group">
			<a class="home-button" role="button" href="bhims-index.html">
				<img src="imgs/bhims_icon_50px.svg" alt="home icon">
			</a>
			<h4 class="page-tile">BHIMS dashboard</h4>
		</div>
		<div class="header-menu-item-group" id="username-container">
			<img id="username-icon" src="imgs/user_icon_50px.svg" alt="username icon">
			<label id="username"></label>
		</div>
	</nav>

	<main class="dashboard-main">

		<!-- nav sidebar -->
		<div class="main-container">
			<nav class="sidebar">
				<div class="sidebar-sticky">
					<div class="sidebar-background"></div>
					<ul class="sidebar-nav-group">

						<li class="nav-item selected">
							<a href="bhims-dashboard.html">
								<img src="imgs/dashboard_icon_50px.svg">
								<span>dashboard</span>
							</a>
						</li>

						<li class="nav-item">
							<a href="query.html">
								<img src="imgs/query_icon_50px.svg">
								<span>query data</span>
							</a>
						</li>

						<li class="nav-item">
							<a href="manage-users.html">
								<img src="imgs/user_icon_50px.svg">
								<span>manage users</span>
							</a>
						</li>

						<li class="nav-item">
							<a href="config.html">
								<img src="imgs/settings_icon_50px.svg">
								<span>configure app</span>
							</a>
						</li>

						<li class="nav-item">
							<a href="bhims-entry-dena.html">
								<img src="imgs/entry_form_icon_50px.svg">
								<span>new encounter</span>
							</a>
						</li>

					</ul>

				</div>
			</nav>

			<!--main dashboard content -->
			<div class="main-content-wrapper">
				<div class="row my-3 short-row">
					
					<!-- need review card --> 
					<div class="col-lg-4 col-md-4 col-sm-6 dashboard-col">
						<div class="card dashboard-card">
							<!--text row -->
							<div class="row">
								<div class="col-lg-5">
									<h1 id="n-needs-review" class="huge-text count-up">20</h1>
								</div>
								<div class="col-lg-7">
									<h3>
										entries need
										<br>
										<span class="large-text">review</span>
									</h3>
								</div>
							</div>

							<!-- bars row -->
							<div class="review-bars-container">
								<div class="needs-review-bar-container">
									<label class="needs-review-bar-label" for="needs-partial-review-bar">needs full review</label>
									<div id="needs-full-review-bar" class="needs-review-bar" title="Proportion of entries needing full review">
									</div>
									<div id="needs-full-review-text" class="needs-review-text">
										<h3 class="count-up">7</h3>
									</div>
								</div>

								<div class="needs-review-bar-container">
									<label class="needs-review-bar-label" for="needs-partial-review-bar">needs partial review</label>
									<div id="needs-partial-review-bar" class="needs-review-bar" title="Proportion of partially reviewed entries">
									</div>
									<div id="needs-partial-review-text" class="needs-review-text">
										<h3 class="count-up">3</h3>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- daily encounters chart card-->
					<div class="col-lg-8 col-md-8 col-sm-12 dashboard-col">
						<div class="card dashboard-card">
							<div class="card-header">
								<h4 class="dashboard-card-title">Daily encounters this year</h4>
							</div>
							<div class="scrollable-chart-and-axis-wrapper">
								<div class="scrollable-chart-outer-wrapper">
									<div class="scrollable-chart-inner-wrapper">
										<canvas id="daily-encounters-chart" class="bhims-chart" height="310"></canvas>
									</div>
								</div>
								<!-- for a horizontally scrollable chart, the axis is a separate plot outside the scrollable div-->
								<canvas id="daily-encounters-axis" class="bhims-chart" height="310" width="0"></canvas>
							</div>
						</div>
					</div>
				
				</div> <!-- row1 -->

				<!-- map row -->
				<div class="row my-4 tall-row">
					<div class="col dashboard-col">
						<div class="card dashboard-card">
							
							<div id="expand-map-button-container">
								<button id="expand-map-button" class="icon-button" onclick="onExpandMapButtonClick(event)"  title="Expand map" aria-label="Expand map">
									<img src="imgs/maximize_window_icon_50px.svg"></img>
								</button>
							</div>
							
							<div class="map" id="encounter-map"></div>
						
						</div>
					</div>
				</div> <!-- row 2-->

			</div> <!--main-content-wrapper-->

		</div> <!--wrapper-->
	</main>

	<!-- map modal -->
	<div class="modal fade lightbox-modal bhims-entry-modal" id="map-modal" tabindex="-1" role="dailog" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-body modal-img-body">
	      	<div class="modal-header-container">
		      	<div class="modal-img-body-header">
			        <button type="button" class="close icon-button" data-dismiss="modal" aria-label="Minimize map">
			          <img src="imgs/minimize_window_icon_50px.svg"></img>
			        </button>
		      	</div>
		    </div>
		    
		    <div class="map modal-map" id="modal-encounter-location-map">  
		    </div>
	      
	      </div>
	    </div>
	  </div>
	</div>

	<script src="js/bhims.js"></script>
	<script src="js/bhims-dashboard.js"></script>
	
	<script>
		$(document).ready(function(){
			// Set global font propety to match rest of app
			Chart.defaults.font.family = `'Barlow', sans-serif`;
			
			configureReviewCard();

			configureDailyEncounterChart();
			
			configureMap('encounter-map');

			// Scroll so the map is in view when clicked
			$('#encounter-map').click(() => {
				window.location.href = '#encounter-map';
				// prevent encounter map jump link from appearing in link
				window.history.replaceState(null, document.title, document.URL.split('#')[0]);
			});

			$.ajax({
				url: 'bhims.php',
				method: 'POST',
				data: {action: 'getUser'},
				cache: false,
				success: function(usernameString){
					// If authentication failed, do nothing
					if (usernameString)  {
						username = usernameString.trim().toLowerCase();
						$('#username').text(username);
					} 
				}
			})
		})
	</script>

</body>

</html>