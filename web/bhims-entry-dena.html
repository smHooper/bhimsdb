<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta name="viewport" content="width=device-width,height=device-height, user-scalable=no" />
	<title>DENA BHIMS - new encounter</title>
	<!--jquery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	
	<!-- bootstrap -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css"/>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>

	<!--fonts -->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

	<!-- font awesome --> 
	<link href="packages/fontawesome/css/all.min.css" rel="stylesheet">

	<!-- Leaflet -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>

	<!-- custom css -->
	<link rel="stylesheet" href="css/bhims-entry.css">
	<link rel="stylesheet" href="css/bhims-entry-dena.css">
	<link rel="stylesheet" href="css/bhims.css">
</head>

<body>
	 <!-- loading indicator should be hidden and will only be shown when loading data -->
	<div class="modal-background modal-background-light hidden" id="loading-indicator-background"></div>
	<div class="hidden" id="loading-indicator"></div>
	<!--<div class="bg-blur-100 full-screen"></div>-->
	<div id="main-container">
		<div class="background-blur vertical-scroll" id="main-form-container">
			<form class="mx-0 px-0 form-container" id="input-form">
				<div class="required-indicator-explanation hidden">
					<span class="required-indicator">*
					<label class=""></span>= required</label>
				</div>
				<div class="form-body">
					<div class="form-section title-section selected" data-section-index="-1">
						<div class="form-title">
							<h1>Bear-Human Incident Form</h1>
							<h4>Denali National Park and Preserve</h4>
						</div>
						<div class="section-body">
							<div class="section-body-content">
								<p class="form-description">
									The information entered in this form will be used to track immediate bear management situations as 
									well as long term trends in bear-human interactions in Denali National Park and Preserve. Please fill
									out the form <strong>once for each bear encounter</strong> that you've had. Thank you for helping preserve 
									and protect Denali's bears.
								</p>
							</div>
						</div>
					</div>

					<div class="form-section" id="section-0" data-section-index="0" data-section-name="people">
						
						<h4 class="section-title">People involved</h4>
						
						<div class="section-body justify-start">
							
							<div class="section-body-content">
								
								<div class="accordion form-item-list" id="people-involved-accordion" data-table-name="people">
									
								  <div class="card cloneable hidden" id="cloneable-card-0">
								    <div class="card-header" id="cardHeader-0-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-0-cloneable" data-target="collapse-0-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label">New person</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="person" aria-label="Delete person">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								      
								    </div>

								    <div id="collapse-0-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-0-cloneable" data-parent="#people-involved-accordion">
								      <div class="card-body">
												<div class="field-container">
														<div class="field-container small-field">
															<input class="input-field card-label-field" type="text" name="first_name" placeholder="First name" id="input-first_name" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-first_name">First name</label>
														</div>
														<div class="field-container small-field">
															<input class="input-field card-label-field" type="text" name="last_name" placeholder="Last name" id="input-last_name" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-last_name">Last name</label>
														</div>
												</div>
												
												<div class="field-container disabled">
													<input class="input-field large-field" type="text" name="address_1" placeholder="Street address" id="input-address_1">
													<label class="field-label" for=input-address_1>Street address</label>
												</div>
												
												<div class="field-container disabled">
													<input class="input-field large-field" type="text" name="address_2" placeholder="Address line 2" id="input-address_2">
													<label class="field-label" for=input-address_2>Address line 2</label>
												</div>
												
												<div class="field-container">
														<div class="field-container small-field">
															<select class="input-field default" type="text" name="country_code" placeholder="Country of residence" id="input-country" onchange="onCountryPostalCodeChange(event)" required></select>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-country">Country of residence</label>
														</div>
														<div class="field-container small-field">
															<input class="input-field" type="text" name="zip_code" placeholder="Postal code" id="input-zip_code" onchange="onCountryPostalCodeChange(event)" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-zip_code">Postal code</label>
														</div>
												</div>
												
												<div class="field-container disabled">
													<div class="field-container small-field">
														<input class="input-field" type="text" name="city" placeholder="City" id="input-city">
														<label class="field-label" for="input-city">City</label>
													</div>
													<div class="collapse field-container small-field">
														<select class="input-field default" name="state_code" placeholder="Select a state" id="input-state" data-dependent-target="#input-country" data-dependent-value="US,CA"></select>
														<label class="field-label" for="input-state">State</label>
													</div>
												</div>
												
												<div class="field-container small-field">
													<input class="input-field" type="email" name="email_address" placeholder="Email" id="input-email_address" required>
													<span class="required-indicator">*</span>
													<label class="field-label" for="input-email_address">Email</label>
												</div>
												<div class="field-container small-field">
													<input class="input-field" type="tel" name="phone_number" placeholder="Phone" id="input-phone_number">
													<label class="field-label" for="input-phone_number">Phone</label>
												</div>
												
												<div class="field-container disabled">
													<div class="field-container small-field">
														<select class="input-field default" name="sex_code" placeholder="Select a gender" id="input-sex_code"></select>
														<label class="field-label" for="input-sex_code">Gender</label>
													</div>
													<div class="field-container small-field">
														<select class="input-field default" name="residency_code" placeholder="Select a residency" id="input-residency_code"></select>
														<label class="field-label" for="input-residency_code">Residency</label>
													</div>
												</div>
												
												<div class="field-container disabled">
													<label class="checkmark-container">
														<input class="input-field input-checkbox" type="checkbox" name="is_primary_person" id="input-is_primary_person">
														<span class="checkmark data-input-checkmark"></span>
													</label>
													<label class="field-label checkbox-label" for="input-is_primary_person">This is the primary reporting person</label>
												</div>
								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>
							
								<div class="add-item-container">
									<button class="generic-button add-item-button" type="button" onclick="onAddNewItemClick(event)" data-target="people-involved-accordion">
										<strong>+</strong> Add person
									</button>
								</div>
							
							</div>
				
						</div>	

						<h4 class="section-title">Group information</h4>
						<div class="section-body scroll validate-field-parent"><!--"validate-field-parent" is a utility class used by validateField()-->
							<div class="section-body-content">

								<!-- Group type -->
								<div class="field-container">
									<div class="field-container small-field">
										<div class="field-container">
											<select class="input-field default" type="text" name="human_group_type_code" placeholder="Type of group" id="input-human_group_type" required></select>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-human_group_type">Type of group</label>
										</div>
										<div class="collapse field-container">
											<input class="input-field" type="text" name="other_human_group_type" placeholder='Description of the "Other" group' id="input-other_human_group_type" data-dependent-target="#input-human_group_type" data-dependent-value="-2" required>
											<label class="field-label" for="input-other_human_group_type">Description of the "Other" group</label>
										</div>
									</div>

									<!-- General human activity -->
									<div class="field-container small-field">
										<div class="field-container">
											<select class="input-field default" type="text" name="general_human_activity_code" placeholder="General group activity" id="input-general_human_activity" required></select>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-general_human_activity">General group activity</label>
										</div>
										<div class="collapse field-container">
											<input class="input-field" type="text" name="other_general_human_activity" placeholder='Description of the "Other" activity' id="input-other_general_human_activity" data-dependent-target="#input-general_human_activity" data-dependent-value="-2" required>
											<label class="field-label" for="input-other_general_human_activity">Description of the "Other" activity</label>
										</div>
									</div>
								</div>


								<!-- Observation type-->
								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="observation_type_code" placeholder="Observation type" id="input-observation_type"></select>
										<label class="field-label" for="input-observation_type">Observation type</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_observation_type" placeholder='Description of the "Other" observation type' id="input-other_observation_type" data-dependent-target="#input-observation_type" data-dependent-value="-2" required>
										<label class="field-label" for="input-other_observation_type">Description of the "Other" observation type</label>
									</div>
								</div>
								
								<!-- Group size -->
								<div class="field-container">
									<div class="field-container small-field">
										<input class="input-field" type="number" name="group_size_total" placeholder="Number of people in group" id="input-group_size_total" min=0 required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-group_size_total">Number of people in group</label>
									</div>
									<div class="field-container small-field disabled">
										<input class="input-field" type="number" name="group_size_encounter" placeholder="Number of people involved in the encounter" id="input-group_size_encounter" min=0>
										<label class="field-label" for="input-group_size_encounter">Number of people involved in the encounter</label>
									</div>
								</div>

								<!-- Safety info -->
								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="received_safety_info" placeholder="Had the group received safety info?" id="input-received_safety_info" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-received_safety_info">Had the group received safety information before the encounter?</label>
									</div>
								</div>
								<div class="collapse field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="safety_info_source_code" placeholder="Safety information source" id="input-safety_info_source" data-dependent-target="#input-received_safety_info" data-dependent-value="1"></select>
										<label class="field-label" for="input-safety_info_source">Safety information source</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_safety_info_source" placeholder='Description of the "Other" information source' id="input-other_safety_info_source" data-dependent-target="#input-safety_info_source" data-dependent-value="-2" required>
										<label class="field-label" for="input-other_safety_info_source">Description of the "Other" safety information source</label>
									</div>
								</div>


								<!-- Firearm and bear spray present -->
								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="bear_spray_was_present" placeholder="Was bear spray present?" id="input-bear_spray_was_present" data-lookup-table="boolean_response_codes"></select>
										<label class="field-label" for="input-bear_spray_was_present">Did anyone in the group have bear spray?</label>
									</div>
									<div class="field-container small-field">
										<select class="input-field default" name="firearm_was_present" placeholder="Was a firearm present?" id="input-firearm_was_present" data-lookup-table="boolean_response_codes"></select>
										<label class="field-label" for="input-firearm_was_present">Did anyone in the group have a firearm?</label>
									</div>
								</div>

								<!-- date and time start -->
								<div class="field-container">
									<div class="field-container small-field">
										<div class="field-container small-field">
											<input class="input-field centered-text" type="date" name="start_date" placeholder="Date of the encounter" id="input-start_date" required>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-start_date">Date of the encounter</label>
										</div>
										<div class="field-container small-field">
											<input class="input-field centered-text" type="time" name="start_time" placeholder="Start time of the encounter" id="input-start_time" required>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-start_time">Time the encounter started</label>
										</div>
									</div>
									<div class="field-container small-field disabled">
										<select class="input-field default" type="text" name="daylight_code" placeholder="General time of day" id="input-daylight_code"></select>
										<label class="field-label" for="input-daylight_code">General time of day</label>
									</div>
								</div>
							
							</div>
						</div>

						<h4 class="section-title mt-5">Location of the encounter</h4>
						<div class="section-body scroll validate-field-parent"><!--"validate-field-parent" is a utility class used by validateField()-->
							<div class="section-body-content">

								<!-- Location fields -->
								<div class="field-container single-line-field">
									<label class="field-label inline-label" for="input-location_type">Describe location by:</label>
									<select class="input-field no-option-fill" id="input-location_type" value="Place name" name="location_type">
										<option value="Place name">Place name</option>
										<option value="Backcountry unit">Backcountry unit</option>
										<option value="Road mile">Road mile</option>
										<option value="GPS coordinates">GPS coordinates</option>
									</select>
								</div>
								<div class="collapse show field-container small-field">
									<select class="input-field default" name="place_name_code" placeholder="Name of the encounter location" id="input-place_name" data-dependent-target="#input-location_type" data-dependent-value="Place name" onchange="onLocationSelectChange(event)" required></select>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-place_name">Name of the encounter location</label>
								</div>
								<div class="collapse field-container small-field">
									<select class="input-field default" name="backcountry_unit_code" placeholder="Backcountry unit" id="input-backcountry_unit" data-dependent-target="#input-location_type" data-dependent-value="Backcountry unit" onchange="onLocationSelectChange(event)" required></select>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-backcountry_unit">Backcountry unit</label>
								</div>
								<div class="collapse field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="road_name_code" placeholder="Road name" id="input-road_name" data-dependent-target="#input-location_type" data-dependent-value="Road mile" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-road_name_code">Road name</label>
									</div>
									<div class="field-container small-field">
										<input class="input-field default" type="number" name="road_mile" placeholder="Road mile" id="input-road_mile" data-dependent-target="#input-location_type" data-dependent-value="Road mile" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-road_mile">Road mile</label>
									</div>
								</div>

								<!-- lat/lon fields -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field no-option-fill" name="coordinate_format" id="input-coordinate_format" value="ddd" required>
											<option value="ddd">Decimal degrees (dd.ddd&#176)</option>
											<option value="ddm">Degrees decimal minutes (dd&#176 mm.mmm)</option>
											<option value="dms">Degrees minutes seconds (dd&#176 mm' ss")</option>
										</select>
										<label class="field-label" for="input-coordinate_format">Coordinate format</label>
									</div>
								</div>
								<div class="field-container">
									<!-- dd.ddd -->
									<div class="collapse show field-container small-field">
										<div class="field-container small-field">
											<input class="input-field input-with-unit-symbol text-right coordinates-ddd" type="number" step="0.00001" min="-90" max="90" name="latitide_dec_deg" placeholder="Lat: dd.ddd" id="input-lat_dec_deg" required>
											<span class="required-indicator">*</span>
											<span class="unit-symbol">&#176</span>
											<label class="field-label" for="input-lat_dec_deg">Latitude</label>
										</div>
										<div class="field-container small-field">
											<input class="input-field input-with-unit-symbol text-right coordinates-ddd" type="number" step="0.00001" min="-180" max="180" name="longitude_dec_deg" placeholder="Lon: ddd.ddd" id="input-lon_dec_deg" required>
											<span class="required-indicator">*</span>
											<span class="unit-symbol">&#176</span>
											<label class="field-label" for="input-lon_dec_deg">Longitude</label>
										</div>
									</div>
									<!--dd mm.mmm-->
									<div class="collapse field-container small-field">
										<div class="field-container small-field justify-content-start">
											<div class="flex-field-container flex-nowrap">
												<input class="input-field input-with-unit-symbol text-right coordinates-ddm" type="number" step="1" min="-90" max="90" placeholder="dd" id="input-lat_deg_ddm" required>
												<span class="required-indicator">*</span>
												<span class="unit-symbol">&#176</span>
											</div>
											<div class="flex-field-container flex-nowrap">
												<input class="input-field input-with-unit-symbol text-right coordinates-ddm" type="number" step="0.001" min="0" max="60" placeholder="mm.mm" id="input-lat_dec_min" required>
												<span class="unit-symbol">'</span>
											</div>
											<label class="field-label">Latitude</label>
										</div>
										<div class="field-container small-field justify-content-start">
											<div class="flex-field-container flex-nowrap">
												<input class="input-field input-with-unit-symbol text-right coordinates-ddm" type="number" step="1" min="-180" max="180" placeholder="ddd" id="input-lon_deg_ddm" required>
												<span class="required-indicator">*</span>
												<span class="unit-symbol">&#176</span>
											</div>
											<div class="flex-field-container flex-nowrap">
												<input class="input-field input-with-unit-symbol text-right coordinates-ddm" type="number" step="0.001" min="0" max="60" placeholder="mm.mmm" id="input-lon_dec_min" required>
												<span class="unit-symbol">'</span>
											</div>
											<label class="field-label">Longitude</label>
										</div>
									</div>
									<!--dd mm ss-->
									<div class="collapse field-container small-field">
										<div class="field-container small-field">
											<div class="field-container degree-field-container">
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="1" min="-90" max="90" placeholder="dd" id="input-lat_deg_dms" required>
													<span class="required-indicator">*</span>
													<span class="unit-symbol">&#176</span>
												</div>
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="1" min="0" max="60" placeholder="mm" id="input-lat_min_dms" required>
													<span class="unit-symbol">'</span>
												</div>
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="0.1" min="0" max="60" placeholder="ss.s" id="input-lat_dec_sec" required>
													<span class="unit-symbol">"</span>
												</div>
											</div>
											<label class="field-label">Latitude</label>
										</div>
										<div class="field-container small-field">
											<div class="field-container degree-field-container">
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="1" min="-180" max="180" placeholder="dd" id="input-lon_deg_dms" required>
													<span class="required-indicator">*</span>
													<span class="unit-symbol">&#176</span>
												</div>
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="1" min="0" max="60" placeholder="mm" id="input-lon_min_dms" required>
													<span class="unit-symbol">'</span>
												</div>
												<div class="flex-field-container flex-nowrap">
													<input class="input-field input-with-unit-symbol text-right coordinates-dms" type="number" step="0.1" min="0" max="60" placeholder="ss.s" id="input-lon_dec_sec" required>
													<span class="unit-symbol">"</span>
												</div>
											</div>
											<label class="field-label">Longitude</label>
										</div>
									</div>
									<div class="field-container small-field">
										<div class="field-container small-field">
											<select class="input-field" name="datum_code" id="input-datum" value="1"></select>
											<label class="field-label" for="input-datum">Datum</label>
										</div>
										<div class="field-container small-field">
											<select class="input-field default" name="location_accuracy_code" id="input-location_accuracy" placeholder="GPS coordinate accuracy"></select>
											<label class="field-label" for="input-location_accuracy">GPS coordinate accuracy</label>
										</div>
									</div>
								</div>
								<!--map-->
								<div class="field-container map-container">
									<div class="marker-container" id="encounter-marker-container">
										<label class="marker-label">Type coordinates manually above or drag and drop the marker onto the map</label>
										<img id="encounter-marker-img" src="https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png" class="draggable-marker" alt="drag and drop the marker">
									</div>
									<div id="expand-map-button-container">
										<button id="expand-map-button" class="icon-button">
											<i class="fas fa-expand-arrows-alt"></i>
										</button>
									</div>
									<div class="map" id="encounter-location-map"></div>
								</div>

								<!--location description-->
								<div class="field-container disabled">
									<input class="input-field" type="text" name="location_description" placeholder="Description of the encounter location" id="input-location_description" required>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-location_description">Description of the encounter location</label>
								</div>

								<!-- relative location (from Glacier's BHIMS form) -->
								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" name="relative_location_code" placeholder="Relative location of the bear" id="input-relative_location"></select>
										<label class="field-label" for="input-relative_location">Relative location of the bear</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_relative_location" placeholder='Description of the "Other" relative location' id="input-other_relative_location" data-dependent-target="#input-relative_location" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_relative_location">Description of the "Other" relative location</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--###################### end of section-0 #########################-->
				

					<!-- ################### section-1 ################## -->
					<div class="form-section" id="section-1" data-section-index="1" data-section-name="encounter-info">
						
						<h4 class="section-title">Bear description</h4>
						<div class="section-body justify-start">
							<div class="section-body-content validate-field-parent">
								
								<div class="field-container">
									<div class="flex-field-container">
										<select class="input-field default dena-bear-field ignore-on-insert" name="bear_species_code" placeholder="Bear species" id="input-bear_species_dena" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-bear_species">Bear species</label>
									</div>
									<div class="flex-field-container">
										<select class="input-field default card-label-field dena-bear-field ignore-on-insert" name="bear_color_code" placeholder="Bear color" data-card-label-index="0" id="input-bear_color_dena" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-bear_color">Bear color</label>
									</div>

									<div class="flex-field-container">
										<div class="field-container">
											<select class="input-field default dena-bear-field" name="bear_cohort_code" placeholder="Bear group type" id="input-bear_cohort" required></select>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-bear_cohort">Bear group type</label>
										</div>
										<div class="collapse field-container">
											<input class="input-field" type="text" name="other_bear_cohort" placeholder='Description of the "Other" bear group type' id="input-other_bear_cohort" data-dependent-target="#input-bear_cohort" data-dependent-value="-2" required>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-other_bear_cohort">Description of the "Other" bear group type</label>
										</div>
									</div>
								</div>

								<!-- disabled fields -->
								<div class="accordion form-item-list hidden" id="bear-info-accordion" data-table-name="bears">
								  <div class="card cloneable hidden" id="cloneable-card-4">
								    <div class="card-header" id="cardHeader-4-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-4-cloneable" data-target="collapse-4-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label label-with-index" data-order-column="bear_number">New bear</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="bear" aria-label="Delete bear">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								      
								    </div>

								    <div id="collapse-4-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-4-cloneable" data-parent="#bear-info-accordion">
								      <div class="card-body">
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default" name="bear_species_code" placeholder="Bear species" id="input-bear_species" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-bear_species">Bear species</label>
													</div>
													<div class="field-container small-field">
														<select class="input-field card-label-field default" name="bear_sex_code" placeholder="Bear sex" id="input-bear_sex" data-card-label-index="1" data-lookup-table="sex_codes" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-bear_sex">Bear sex</label>
													</div>
												</div>
												
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default card-label-field" name="bear_color_code" placeholder="Bear color" data-card-label-index="0" id="input-bear_color" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-bear_color">Bear color</label>
													</div>
													<div class="field-container small-field">
														<select class="input-field card-label-field default" name="bear_age_code" placeholder="Bear age" id="input-bear_age" data-card-label-index="2" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-bear_age">Bear age</label>
													</div>
												</div>
												
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default" name="bear_injury_code" placeholder="Was this bear injured?" id="input-bear_injury"></select>
														<label class="field-label" for="input-bear_injury">Bear injury</label>
													</div>
												</div>
												
												<div class="field-container">
													<div class="field-container small-field">
														<input class="input-field" type="text" name="bear_park_id" placeholder="ID for this bear (if known)" id="input-bear_park_id">
														<label class="field-label" for="input-bear_park_id">ID for this bear</label>
													</div>
												</div>

												<div class="field-container">
													<input class="input-field" type="text" name="bear_description" placeholder="Other notabled markings or features" id="input-bear_description">
													<label class="field-label" for="input-bear_description">Other notabled markings or features</label>
												</div>

												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default" name="previously_encountered" placeholder="Was this bear encountered before?" id="input-previously_encountered" data-lookup-table="boolean_response_codes"></select>
														<label class="field-label" for="input-previously_encountered">Was this bear encountered before?</label>
													</div>
												</div>

								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>

								<div class="field-container small-field disabled">
									<select class="input-field card-label-field default" name="bear_age_code" placeholder="Bear age" id="input-bear_age" data-card-label-index="2" required></select>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-bear_age">Bear age</label>
								</div>

								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" name="bear_injury_code" placeholder="Was this bear injured?" id="input-bear_injury"></select>
										<label class="field-label" for="input-bear_injury">Bear injury</label>
									</div>
								</div>
								
								<div class="field-container disabled">
									<div class="field-container small-field">
										<input class="input-field" type="text" name="bear_park_id" placeholder="ID for this bear (if known)" id="input-bear_park_id">
										<label class="field-label" for="input-bear_park_id">ID for this bear</label>
									</div>
								</div>

								<div class="field-container disabled">
									<input class="input-field" type="text" name="bear_description" placeholder="Other notabled markings or features" id="input-bear_description">
									<label class="field-label" for="input-bear_description">Other notabled markings or features</label>
								</div>

								<div class="field-container disabled">
									<div class="field-container small-field">
										<select class="input-field default" name="previously_encountered" placeholder="Was this bear encountered before?" id="input-previously_encountered" data-lookup-table="boolean_response_codes"></select>
										<label class="field-label" for="input-previously_encountered">Was this bear encountered before?</label>
									</div>
								</div>
							</div>
						</div>
						<!-- end of bears -->

						<h4 class="section-title mt-5">Encounter information</h4>
						<div class="section-body scroll validate-field-parent"><!--"validate-field-parent" is a utility class used by validateField()-->
							<div class="section-body-content">

								<!-- Habitat type -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="habitat_type_code" placeholder="Vegitation type" id="input-habitat_type" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-habitat_type">Vegitation type</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_habitat_type" placeholder='Description of the "Other" habitat type' id="input-other_habitat_type" data-dependent-target="#input-habitat_type" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_habitat_type">Description of the "Other" habitat type</label>
									</div>
								</div>

								<!--habitat description-->
								<div class="field-container disabled">
									<input class="input-field" type="text" name="habitat_description" placeholder="Vegetation type" id="input-location_description" required>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-habitat_description">Vegation type</label>
								</div>

								<!-- visibility -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="visibility_code" placeholder="Descibe the visibility around the encounter location" id="input-visibility" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-visibility">Descibe the visibility around the encounter location</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_visibility" placeholder='Description of the "Other" visibility' id="input-other_visibility" data-dependent-target="#input-visibility" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_visibility">Description of the "Other" visibility</label>
									</div>
								</div>

								<!--vis distance and description-->					
								<div class="field-container disabled">
									<div class="field-container small-field">
										<div class="field-container flex-field-container">
											<input class="input-field text-right-when-valid meters-field" type="number" min="0" name="visibility_distance_m" placeholder="Approximately how far could you see?" id="input-visibility_distance_m" required>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-visibility_distance_m">Approximately how far could you see?</label>
										</div>
										<div class="units-field-container">
											<select class="input-field centered-text units-field" id="input-visibility_distance_units" value="ft" data-calculation-target="#input-visibility_destance_m" required>
												<option value="ft">feet</option>
												<option value="m">meters</option>
											</select>
										</div>
									</div>
									<div class="field-container small-field">
										<input class="input-field" type="text" name="visibility_description" placeholder="Visibility description" id="input-visibility_description" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-visibility_description">Visibility description</label>
									</div>
								</div>
								
								<!-- Duration -->
								<div class="field-container disabled">
									<div class="field-container small-field">
										<input class="input-field" type="number" name="duration_minutes" min=0 step=1 placeholder="Duration of the encounter (in minutes)" id="input-duration_minutes" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-duration_minutes">Duration of the encounter (in minutes)</label>
									</div>
									<div class="field-container small-field">
										<select class="input-field default" type="number" name="duration_code" placeholder="Duration of the encounter" id="input-duration_code"></select>
										<label class="field-label" for="input-duration_code">Duration of the encounter</label>
									</div>
								</div>
								
								<!-- People present -->
								<div class="field-container disabled">
									<select class="input-field default" name="people_present_code" placeholder="Were people present during the encounter?" id="input-people_present_code" required></select>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-people_present_code">Were people present for the encounter?</label>
								</div>

								<!-- Bear was seen -->
								<div class="field-container disabled">
									<select class="input-field default" type="text" name="bear_was_seen" placeholder="Did anyone see the bear?" id="input-bear_was_seen" data-lookup-table="boolean_response_codes" required></select>
									<span class="required-indicator">*</span>
									<label class="field-label" for="input-bear_was_seen">Did anyone see the bear?</label>
								</div>

								<!-- Distance of the bear -->
								<div class="field-container small-field">
									<div class="flex-field-container">
										<input class="input-field text-right-when-valid" type="number" name="initial_distance_m" placeholder="How close was the bear at first?" id="input-initial_distance" data-dependent-target="#input-bear_was_seen" data-dependent-value="1" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-inital_distance">How far was the bear when you first saw it?</label>
									</div>
									<div class="units-field-container">
										<select class="input-field centered-text" id="input-initial_distance_units" value="ft" required>
											<option value="ft">feet</option>
											<option value="m">meters</option>
										</select>
									</div>
								</div>
								<div class="field-container small-field">
									<div class="flex-field-container">
										<input class="input-field text-right-when-valid" type="number" name="closest_distance_m" placeholder="How close did the bear get to people?" id="input-closest_distance" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-inital_distance">How close did the bear get to you or other people?</label>
									</div>
									<div class="units-field-container">
										<select class="input-field centered-text" id="input-closest_distance_units" value="ft" required>
											<option value="ft">feet</option>
											<option value="m">meters</option>
										</select>
									</div>
								</div>

								<!-- Making noise-->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="was_making_noise" placeholder="Was the group making noise?" id="input-was_making_noise" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-was_making_noise">Was the group making noise to warn bears of their presence?</label>
									</div>
								</div>
								<div class="field-container disabled">
									<div class="collapse field-container small-field">
										<select class="input-field default" type="text" name="making_noise_code" placeholder="What type of noise was the group making?" id="input-making_noise" data-dependent-target="#input-was_making_noise" data-dependent-value="1" required></select>
										<label class="field-label" for="input-making_noise">What type of noise was the group making to warn bears of their presence?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_making_noise" placeholder='Description of the "Other" type of noise' id="input-other_making_noise" data-dependent-target="#input-making_noise" data-dependent-value="999" required>
										<label class="field-label" for="input-other_making_noise">Description of the "Other" type of noise</label>
									</div>
								</div>

								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="initial_human_action_code" placeholder="What were you doing before you noticed the bear?" id="input-initial_human_action" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-initial_human_action">What were you doing before you noticed the bear?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_initial_human_action" placeholder='Description of your "Other" initial action' id="input-other_initial_human_action" data-dependent-target="#input-initial_human_action" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_initial_human_action">Description of your "Other" initial action</label>
									</div>
								</div>

								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="initial_bear_action_code" placeholder="What was the bear primarily doing when you first notcied it?" id="input-initial_bear_action" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-initial_human_action">What was the bear primarily doing when you first noticed it?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_initial_bear_action" placeholder="Description of the bear's &quot;Other&quot; initial action" id="input-other_initial_bear_action" data-dependent-target="#input-initial_bear_action" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_initial_bear_action">Description of the bear's "Other" initial action</label>
									</div>
								</div>

								<h5 class="section-title mt-3">Interaction details</h5>
								<div class="collapse accordion form-item-list" id="reactions-accordion" data-table-name="reactions">
								  <div class="card cloneable hidden" id="cloneable-card-5">
								    <div class="card-header" id="cardHeader-5-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-5-cloneable" data-target="collapse-5-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label label-with-index" data-order-column="reaction_order" data-label-sep=": ">What happened next?</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="reaction" aria-label="Delete reaction">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								      
								    </div>

								    <div id="collapse-5-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-5-cloneable" data-parent="#reactions-accordion">
								      <div class="card-body">
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default card-label-field" name="reaction_by" placeholder="Who reacted next?" id="input-reaction_by" data-lookup-table="reaction_by_codes" data-card-label-index="0" onchange="updateReactionsSelect($(event.target))" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-reaction_by">Reaction by</label>
													</div>
													<div class="field-container small-field">
														<select class="input-field default card-label-field no-option-fill" name="reaction_code" placeholder="Select who reacted to see reaction options" id="input-reaction" data-card-label-index="1" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-reaction"></label>
													</div>
												</div>
												
												<div class="collapse field-container">
													<input class="input-field" type="text" name="other_reaction" placeholder="Description of the &quot;Other&quot; reaction" id="input-other_reaction" data-dependent-target="#input-reaction" data-dependent-value="10,113,204" required>
													<span class="required-indicator">*</span>
													<label class="field-label" for="input-other_reaction">Description of the "Other" reaction</label>
												</div>
												

								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>
							
								<div class="collapse add-item-container">
									<button class="generic-button add-item-button" type="button" onclick="onAddNewItemClick(event)" data-target="reactions-accordion">
										<strong>+</strong> Add reaction
									</button>
								</div>

							</div>
						</div>
					</div>
					<!--###################### end of section-1 #########################-->
					

					<!--########################## section-2 ############################-->
					
					<div class="form-section" id="section-2" data-section-index="2" data-section-name="Page 3">
						
						<h4 class="section-title">Encounter information (continued)</h4>
						<div class="section-body justify-start">
							<div class="section-body-content validate-field-parent">
								
								<!-- Reported probable cause -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="reported_probable_cause_code" placeholder="What do you think caused the encounter?" id="input-reported_probable_cause" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-reported_probable_cause">What do you think was the probable cause for the encounter?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_reported_probable_cause" placeholder='Description of the "Other" probable cause' id="input-other_reported_probable_cause" data-dependent-value="-2" data-dependent-target="#input-reported_probable_cause" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_reported_probable_cause">Description of the "Other" probable cause</label>
									</div>
								</div>
								
								<!-- bear charged -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="bear_charged" placeholder="Did the bear charge?" id="input-bear_charged" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-bear_charged">Did the bear charge?</label>
									</div>
								</div>
								<!-- furtherst charge distance -->
								<div class="collapse field-container">
									<div class="field-container small-field">
										<div class="field-container flex-field-container">
											<input class="input-field text-right-when-valid" type="number" name="greatest_charge_distance_m" placeholder="Greatest distance the bear charged from" id="input-greatest_charge_distance_m" data-dependent-target="#input-bear_charged" data-dependent-value="1" required>
											<span class="required-indicator">*</span>
											<label class="field-label" for="input-greatest_charge_distance_m">Greatest distance the bear charged from</label>
										</div>
										<div class="units-field-container">
											<select class="input-field centered-text" id="input-closest_distance_units" value="ft" required>
												<option value="ft">feet</option>
												<option values="m">meters</option>
											</select>
										</div>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field default" type="number" min=1 name="charge_count" placeholder="How many times did the bear charge?" id="input-charge_count" data-dependent-target="#input-bear_charged" data-dependent-value="1">
										<label class="field-label" for="input-charge_count">How many times did the bear charge?</label>
									</div>
								</div>

								<!-- food present -->
								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="food_present_code" placeholder="Was human food present?" id="input-food_present_code" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-safety_info_source">Was human food present during the encounter?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="other_food_present" placeholder='Description of the "Other" food present' id="input-other_food_present" data-dependent-target="#input-food_present_code" data-dependent-value="-2" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-other_food_present">Description of the "Other" food present</label>
									</div>
								</div>

								<!-- bear obtained food -->
								<div class="collapse field-container">
									<div class="field-container small-field">
										<select class="input-field default" type="text" name="bear_obtained_food" placeholder="Did the bear obtain food?" id="input-bear_obtained_food" data-lookup-table="boolean_response_codes" data-dependent-target="#input-food_present_code" data-dependent-value="1,2" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-bear_obtained_food">Did the bear obtain any food?</label>
									</div>
									<div class="collapse field-container small-field">
										<input class="input-field" type="text" name="consumed_food_description" placeholder='Describe the food and how much was consumed' id="input-consumed_food_description" data-dependent-target="#input-bear_obtained_food" data-dependent-value="1" required>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-consumed_food_description">Description and quantity of consumed food</label>
									</div>
								</div>



							</div>
						
						</div>	
						
						<h5 class="section-title mt-3">Property damage</h4>
						<div class="section-body justify-start">
							<div class="section-body-content validate-field-parent">

								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="was_property_damaged" placeholder="Was any property damaged?" id="input-was_property_damaged" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-initial_human_action">Was any personal property damaged?</label>
									</div>
								</div>

								<div class="accordion form-item-list collapse" id="property-accordion" data-dependent-target="#input-was_property_damaged" data-dependent-value="1" data-table-name="property_damage">
								  
								  <div class="card cloneable hidden" id="cloneable-card-6">
								    <div class="card-header" id="cardHeader-6-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-6-cloneable" data-target="collapse-6-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label">New property details</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="property item" aria-label="Delete property item">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								    </div>
								    <div id="collapse-6-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-6-cloneable" data-parent="#property-accordion">
								      <div class="card-body">
												<div class="field-container">
													<div class="field-container small-field">
														<div class="field-container mini-field">
															<input class="input-field text-right-when-valid" type="number" min="0" name="quantity" placeholder="Quantity" id="input-property_quantity" required></select>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-property_quantity">Quantity</label>
														</div>
														<div class="field-container flex-field-container">
															<input class="input-field card-label-field" type="text" name="property_description" placeholder="Description of the property" id="input-property_description" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-other_reaction">Description of the property</label>
														</div>
													</div>
													<div class="field-container small-field">
														<div class="field-container small-field">
															<span class="unit-symbol unit-symbol-left">$</span>
															<input class="input-field" type="number" min="0" step="0.01" name="property_value" placeholder="Property value" id="input-property_value" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-property_value">Property value</label>
														</div>
														<div class="field-container small-field disabled">
															<span class="unit-symbol unit-symbol-left">$</span>
															<input class="input-field" type="number" min="0" step="0.01" name="damage_cost" placeholder="Cost of damage" id="input-damage_cost" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-damage_cost">Damage cost</label>
														</div>
													</div>
												</div>

												<div class="field-container disabled">
													<div class="field-container small-field">
														<select class="input-field default" type="text" name="was_in_persons_control" placeholder="Was this item within your control?" id="input-was_in_persons_control" data-lookup-table="boolean_response_codes"></select>
														<label class="field-label" for="input-was_in_persons_control">Was this item within your control?</label>
													</div>
												</div>

												<div class="field-container disabled">		
													<div class="field-container small-field">
														<select class="input-field default" type="text" name="item_was_recovered" placeholder="Did you revover this item?" id="input-item_was_recovered" data-lookup-table="boolean_response_codes"></select>
														<label class="field-label" for="input-item_was_recovered">Did you revover this item?</label>
													</div>
													<div class="field-container small-field collapse">
														<div class="field-container small-field">
															<span class="unit-symbol unit-symbol-left">$</span>
															<input class="input-field" type="number" min="0" step="0.01" name="recovered_value" placeholder="Recovered value" id="input-recovered_value" data-dependent-target="#input-item_was_recovered" data-dependent-value="1" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-recovered_value">Recovered value</label>
														</div>
														<div class="field-container small-field">
															<input class="input-field" type="date" name="recovery_date" placeholder="When did you recover the item?" id="input-recovery_date" required>
															<span class="required-indicator">*</span>
															<label class="field-label" for="input-quantity">When did you recover the item?</label>
														</div>
													</div>
												</div>

								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>
							
								<div class="add-item-container collapse">
									<button class="generic-button add-item-button" type="button" onclick="onAddNewItemClick(event)" data-target="property-accordion" data-dependent-target="#input-was_property_damaged" data-dependent-value="1">
										<strong>+</strong> Add property
									</button>
								</div>
							
							</div>
						
						</div>	
						
						<h5 class="section-title">Structure interactions</h4>
						<div class="section-body justify-start">
							<div class="section-body-content validate-field-parent">

								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="structures_were_involved" placeholder="Did the bear interact with any structures?" id="input-structures_were_involved" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-structures_were_involved">Did the bear interact with any structures?</label>
									</div>
								</div>

								<div class="accordion form-item-list collapse" id="structure-interactions-accordion" data-dependent-target="#input-structures_were_involved" data-dependent-value="1" data-table-name="structure_interactions">
								  
								  <div class="card cloneable hidden" id="cloneable-card-8">
								    <div class="card-header" id="cardHeader-8-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-8-cloneable" data-target="collapse-8-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label">New structure interaction</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="structure interaction" aria-label="Delete structure interaction">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								    </div>
								    <div id="collapse-8-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-8-cloneable" data-parent="#structure-interactions-accordion">
								      <div class="card-body">
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default card-label-field" name="structure_type_code" placeholder="What kind of structure was involved?" id="input-structure_type" data-card-label-index="0" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-structure_type">What kind of structure was involved?</label>
													</div>
													<div class="field-container small-field collapse">
														<input class="input-field" type="text" name="other_structure_type" placeholder="Description of the &quot;Other&quot; structure type" id="input-other_structure_type" data-dependent-target="#input-structure_type" data-dependent-value="-2" required>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-other_structure_type">Description of the "Other" structure type</label>
													</div>
												</div>
												
												<div class="field-container">
													<div class="field-container small-field">
														<select class="input-field default" name="structure_interaction_code" placeholder="How did the bear interact with the structure?" id="input-interaction_code" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-interaction_code">How did the bear interact with the structure?</label>
													</div>
													<div class="field-container small-field">
														<input class="input-field" type="text" min="1" name="structure_description" placeholder="Structure description" id="input-structure_description" required>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-structure_description">Structure description</label>
													</div>
												</div>
								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>
							
								<div class="add-item-container collapse">
									<button class="generic-button add-item-button" type="button" onclick="onAddNewItemClick(event)" data-target="structure-interactions-accordion" data-dependent-target="#input-structures_were_involved" data-dependent-value="1">
										<strong>+</strong> Add interaction
									</button>
								</div>
							
							</div>
						
						</div>	
					</div>
					<!-- end of section-8 -->

					<!--########################## section-3 ############################-->
					<div class="form-section" id="section-3" data-section-index="3" data-section-name="narrative">
						
						<h4 class="section-title">Description of the encounter</h4>
						<div class="section-body justify-start">
							<div class="section-body-content validate-field-parent">
								<!--<button class="icon-button mb-2 hidden tooltipped" id="record-narrative-button">
									<span class="record-on-indicator"></span>
									<i class="pointer fa fa-2x fa-microphone" id="narrative-mic-icon"></i>
									<div class="tip tip-right">
										<h6>Start dictation</h6>
										<i class="tooltip-arrow"></i>
									</div>
								</button>-->
								<div class="field-container">
									<textarea class="input-field narrative-field" name="narrative" placeholder="Please describe the encounter in your own words" id="input-narrative" required></textarea>
									<span class="required-indicator">*</span>
									<div class="recorded-text-container">
										<span id="recorded-text-final" contenteditable="true"></span>
										<span id="recorded-text-interim"></span>
									</div>
									<div class="mic-button-container">
										<label class="recording-status-message" id="recording-status-message"></label>
										<button class="icon-button mb-2 hidden tooltipped" id="record-narrative-button">
											<!--<span class="record-on-indicator"></span>-->
											<i class="pointer fa fa-2x fa-microphone" id="narrative-mic-icon"></i>
											<!--<div class="tip tip-left">
												<h6>Start dictation</h6>
												<i class="tooltip-arrow"></i>
											</div>-->
										</button>
									</div>
								</div>

								<div class="field-container">
									<div class="field-container small-field">
										<select class="input-field default" name="has_attachments" placeholder="Do you have any files to attach (photos, videos, etc.)?" id="input-has_attachments" data-lookup-table="boolean_response_codes" required></select>
										<span class="required-indicator">*</span>
										<label class="field-label" for="input-has_attachments">Do you have any files to attach (photos, videos, etc.)?</label>
									</div>
								</div>
								
								<div class="accordion form-item-list collapse" id="attachments-accordion" data-dependent-target="#input-has_attachments" data-dependent-value="1" data-table-name="attachments">
								  
								  <div class="card cloneable hidden" id="cloneable-card-9">
								    <div class="card-header" id="cardHeader-9-cloneable">
											<a class="card-link" data-toggle="collapse" href="#collapse-9-cloneable" data-target="collapse-9-cloneable">
												<div class="card-link-content">
													<h5 class="card-link-label">New attached file</h5>
												</div>
												<div class="card-link-content">
													<button class="delete-button icon-button" type="button" onclick="onDeleteCardClick(event)" data-item-name="attachment" aria-label="Delete attachment">
														<i class="fas fa-trash fa-lg"></i>
													</button>
													<i class="fa fa-chevron-down pull-right"></i>
												</div>
											</a>
								    </div>
								    <div id="collapse-9-cloneable" class="collapse show card-collapse" aria-labelledby="cardHeader-9-cloneable" data-parent="#attachments-accordion">
								      <div class="card-body">
												<div class="field-container align-items-center">
													<div class="field-container small-field">
														<select class="input-field default" name="file_type_code" placeholder="What type of file are you uploading?" id="input-file_type" onchange="onAttachmentTypeChange(event)" required></select>
														<span class="required-indicator">*</span>
														<label class="field-label" for="input-file_type_code">What kind of file are you uploading?</label>
													</div>
													<div class="collapse field-container small-field">
														<div class="collapse field-container small-field file-preview-container">
															<div class="attachment-progress-bar-container">
																<div class="attachment-progress-bar">
																	<div class="attachment-progress-indicator"></div>
																</div>
															</div>
															<img class="file-thumbnail hidden" src="#" alt="thumbnail" onclick="onThumbnailClick(event)" alt="clickable thumbnail of uploaded file">
														</div>
														<div class="attachment-file-input-container">
															<label class="filename-label"></label>
															<label class="generic-button text-center file-input-label" for="attachment-upload">select file</label>
															<input class="input-field hidden attachment-input" id="attachment-upload" type="file" accept="" name="uploadedFile" data-dependent-target="#input-file_type" data-dependent-value="!<blank>" onchange="onAttachmentInputChange(event)" required>
														</div>
													</div>
												</div>

												<div class="field-container">
													<input class="input-field" type="text" min="1" name="file_description" placeholder="What does this file depict?" id="input-file_description" required>
													<span class="required-indicator">*</span>
													<label class="field-label" for="input-file_description">What does this file depict?</label>
												</div>
								      </div>
								    </div>
								    <!--end of card -->
								  </div>

								</div>
							
								<div class="add-item-container collapse">
									<button class="generic-button add-item-button" type="button" onclick="onAddNewItemClick(event)" data-target="attachments-accordion" data-dependent-target="#input-has_attachments" data-dependent-value="1">
										<strong>+</strong> Add attachment
									</button>
								</div>
							
							</div>
						
						</div>	
					</div>
					<!-- end of section-9 -->

					<!--########################## section-10 ############################-->
					<div class="form-section submit-section" id="section-4" data-section-index="4" data-section-name="submit">
						
						<h4 class="section-title"></h4>
						<div class="section-body">
							<div class="section-body-content">
								<p class="form-description" id="submit-message">
									Once you have verified the information you've entered, click the submit button below
								</p>
								<div class="submit-button-container">
									<button class="generic-button form-navigation" type="button" onclick="onSubmitButtonClick(event)" id="submit-button">Submit encounter</button>
								</div>
								<div class="submition-confirmation-container hidden">
									<h4>Submission successful</h4>
									<p class="form-description">Thank you for submitting information about this bear encounter.
									</p>
									<a href="http://inpdenards.nps.doi.net:8282/bhims-index.html">Return to the home page</a>
								</div>
							</div>
						
						</div>	
					</div>
					<!-- end of section-10 -->
				</div>
				<!--########### end of form body ##########################-->

				<div class="form-footer">
					<button class="generic-button form-navigation hidden" type="button" id="previous-button" onclick="onPreviousNextButtonClick(event, -1)" disabled>previous</button>
					<ol class="section-indicator form-navigation hidden">
						<li>
							<button class="indicator-dot" type="button" onclick="onIndicatorDotClick(event)" data-section-index="0" aria-label="Page 1">
								<!--<div class="tip">
									<h6>People involved</h6>
									<i class="tooltip-arrow"></i>
								</div>-->
							</button>
						</li>
						<li>
							<button class="indicator-dot" type="button" onclick="onIndicatorDotClick(event)" data-section-index="1" aria-label="Page 2">
								<!--<div class="tip">
									<h6>Group information</h6>
									<i class="tooltip-arrow"></i>
								</div>-->
							</button>
						</li>
						<li>
							<button class="indicator-dot" type="button" onclick="onIndicatorDotClick(event)" data-section-index="2" aria-label="Page 3">
								<!--<div class="tip">
									<h6>Encounter information</h6>
									<i class="tooltip-arrow"></i>
								</div>-->
							</button>
						</li>
						<li>
							<button class="indicator-dot" type="button" onclick="onIndicatorDotClick(event)" data-section-index="3" aria-label="Page 4">
								<!--<div class="tip">
									<h6>Location description</h6>
									<i class="tooltip-arrow"></i>
								</div>-->
							</button>
						</li>
						<li>
							<button class="indicator-dot" type="button" onclick="onIndicatorDotClick(event)" data-section-index="4" aria-label="Submission page">
								<!--<div class="tip">
									<h6>Location description</h6>
									<i class="tooltip-arrow"></i>
								</div>-->
							</button>
						</li>
					</ol>
					<button class="generic-button form-navigation hidden" type="button" id="next-button" onclick="onPreviousNextButtonClick(event, 1)">next</button>
					<button class="generic-button" type="button" id="title-section-continue-button">continue</button>
					<input class="generic-button hidden" id="submit-button" type="submit" value="submit">

				</div>	
			</form>

		</div>

	</div>

	<!--attachment preview modal -->
	<div class="modal fade lightbox-modal" id="attachment-modal" tabindex="-1" role="dialog" aria-hidden="true">
	  <div class="modal-dialog" role="document" data-dismiss="modal">
	    <div class="modal-content" data-dismiss="modal">
	      <div class="modal-body modal-img-body">
	      	<div class="modal-header-container">
		      	<div class="modal-img-body-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
		      	</div>
		      </div>
	      	<img class="modal-img hidden" src="#" id="modal-img-preview" data-dismiss="modal" alt="preview of uploaded image">
	      	<video class="modal-img hidden" id="modal-video-preview" width="320" height="240" controls alt="preview of uploaded video">
	      		<source src="#">
	      		Sorry, your browser does not support HTML video content
	      	</video>
	      	<audio class="modal-img hidden" id="modal-audio-preview" controls alt="preview of uploaded audio">
	      		<source src="#">
	      		Sorry, your browser does not support HTML audio content
	      	</audio>
	      </div>
	    </div>
	  </div>
	</div>

	<!--alert/message modal -->
	<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"></div>

	<script src="js/bhims.js"></script>
	<script src="js/bhims-entry.js"></script>
	
	<script type="text/javascript">

		//Instantiate global map and marker vars
		//	The encounter marker isn't added to the map until the user explicitly
		//	does so, but to instantiate with options it needs a location
		var ENCOUNTER_MAP;
		var ENCOUNTER_MARKER = new L.marker([0, 0], {
				draggable: true,
				autoPan: true,
		})
			.on('dragend', setCoordinatesFromMarker);
		// Other globals
		var 
			ATTACHMENT_FILES = {},
			FIELD_INFO = {},
			FIELD_VALUES = {},
			USERNAME,
			BACKCOUNTRY_UNIT_COORDINATES = {},
			PLACE_NAME_COORDINATES = {},
			ACCEPTED_ATTACHMENT_EXT = {};

		// The page takes a few seconds to load sometimes so make sure the user 
		//	doesn't click the continue button before everything is set up
		showLoadingIndicator('onload');

		// Query accepted file attachment extensions for each file type
		queryDB(`SELECT code, accepted_file_ext FROM file_type_codes WHERE sort_order IS NOT NULL;`)
			.then(
				doneFilter=function(queryResultString){
					if (queryResultString.startsWith('ERROR') || queryResultString === '["query returned an empty result"]') {
						throw 'Accepted file extension query failed: ' + queryResultString;
					} else {
						const queryResult = $.parseJSON(queryResultString);
						queryResult.forEach(function(object) {
							ACCEPTED_ATTACHMENT_EXT[object.code] = object.accepted_file_ext;
						})
					}
				},
				failFilter=function(xhr, status, error) {
					console.log(`Accepted file extension query failed with status ${status} because ${error} from query:\n${sql}`)
				}
		);

		$(document).ready(function() {

			// Get field info
			getFieldInfo();

			$(window).on('load', ()=>{hideLoadingIndicator()});

			// Set on click for continue button (shown only in title section).
			//	In addition to going to next section, show required indicator explanation
			$('#title-section-continue-button').click((event) => {
				onPreviousNextButtonClick(event, 1);
				$('.required-indicator-explanation').removeClass('hidden');
			})

			// If the user does not have previous data saved, add the first card here in 
			//	case this same form is used for data viewing. If there is saved data, the 
			//	form and all inputs will be restored from the previous session
			$('.accordion.form-item-list').each((_, el) => {
				const tableName = $(el).data('table-name');
				if (!(tableName in FIELD_VALUES)) addNewCard($(el));
			});

			// fill selects
			let deferreds = $('select').map( function() {
				const $el = $(this);
				const placeholder = $el.attr('placeholder');
				const lookupTable = $el.data('lookup-table');
				const lookupTableName = lookupTable ? lookupTable : $el.attr('name') + 's';
				const id = this.id;
				if (lookupTableName != 'undefineds') {//if neither data-lookup-table or name is defined, lookupTableName === 'undefineds' 
					if (placeholder) $('#' + id).append(`<option class="" value="">${placeholder}</option>`);
					if (!$el.is('.no-option-fill')) {
						return fillSelectOptions(id, `SELECT code AS value, name FROM ${lookupTableName} WHERE sort_order IS NOT NULL ORDER BY sort_order`);
					}
				}
			})
			$.when(
				...deferreds
			).then(function() {
				fillFieldsFromSavedData()
			});

			$('select').change(onSelectChange);
			// Set additional change event for initial action selects
			$('#input-initial_human_action, #input-initial_bear_action').change(onInitialActionChange);

			// When an input changes, save the result to the FIELD_VALUES global object so data are persistent
			$('.input-field').change(onInputFieldChange);

			//When a field with units changes, re-calculate
			$('.units-field').change(onUnitsFieldChange);

			// When a card is clicked, close any open cards in the same accordion
			$('.collapsed').click(function() {
				const $accordion = $(this).closest('.accordion');
				$accordion.find('.card:not(.cloneable) .collapse.show')
					.removeClass('show')
					.siblings()
						.find('.card-header')
						.addClass('collapsed');
			});

			// Make sure the hidden class is added/removed when bootstrap collapse events fire
			$('.collapse.field-container, .collapse.accordion')
				.on('hidden.bs.collapse', function () {
					$(this).addClass('hidden');
				})
				.on('show.bs.collapse', function () {
					$(this).removeClass('hidden');
				});

			// When any card-label-fields change, try to set the parent card label
			$('.input-field.card-label-field').change(function() {onCardLabelFieldChange($(this))});

			// When the user types anything in a field, remove the .error class (if it was assigned)
			$('.input-field').on('keyup change', onInputFieldKeyUp);

			// Set up coordinate fields to update eachother and the map
			$('.coordinates-ddd').change(onDDDFieldChange);
			$('.coordinates-ddm').change(onDMMFieldChange);
			$('.coordinates-dms').change(onDMSFieldChange);
			$('#input-coordinate_format').change(onCoordinateFormatChange);

			// Set up the map
			ENCOUNTER_MAP = configureMap();

			// Prevent form submission when the user hits the 'Enter' key
			$('.input-field').keydown((e) => { 
				//if (event.which == 13) event.returnValue(); 
				e = e || event;
				var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);
				return txtArea || (e.keyCode || e.which || e.charCode || 0) !== 13;
			});

			var recognition = initSpeechRecognition();
			if (recognition) {
				$('#record-narrative-button')
					.click(onMicIconClick)
					.removeClass('hidden');
			}

			// When the user manually types (rather than dictates) the narrative, 
			//	set the narrative textarea val
			$('#recorded-text-final').on('input', (e) => {
				$('#input-narrative')
					.val($(e.target).text())
					.change();
			})

			//add event listeners for contenteditable and textarea size change: https://stackoverflow.com/questions/1391278/contenteditable-change-events
			//might have to use resizeobserver: https://stackoverflow.com/questions/6492683/how-to-detect-divs-dimension-changed

			// resize modal video preview when new video is loaded
			$('#modal-video-preview').on('loadedmetadata', function(event){
				const el = event.target;
				const aspectRatio = el.videoHeight / el.videoWidth;
				
			});
			
			$('#modal-audio-preview').on('loadedmetadata', function(event){
				// Set width so close button is on the right edge of video/audio
				const $el = $(event.target);
				
				var maxWidth;
				try {
					maxWidth = $el.css('max-width').match(/\d+/)[0];
				} catch {
					return
				}
	
				$el.closest('.modal')
					.find('.modal-img-body')
						.css('width', Math.min(maxWidth, window.innerWidth) + 'px');
			});

			$('#attachment-modal').on('hidden.bs.modal', function (event) {
				// Release resources of video preview when modal closes
				const $source = $('#modal-video-preview,#modal-audio-preview').not('.hidden').find('source');
				const currentSrc = $source.attr('src');
				if (currentSrc != "#") {
					URL.revokeObjectURL(currentSrc);
					$source.attr('src', '#');
				}

				// Remove any inline css to the img/video/audio container element
				$(event.target).find('.modal-img-body').css('width', '');

			});

			// Save user input when the user leaves the page
			$(window).on('beforeunload', function(event) {
				if (Object.keys(FIELD_VALUES).length) {//FIELD_VALUES is cleared on submit
					const pageName = window.location.pathname.split('/').pop();
					var currentStorage = $.parseJSON(window.localStorage[pageName] || '{}');

					// Record map extent
					currentStorage.encounterMapInfo = {
						center: markerIsOnMap() ? ENCOUNTER_MARKER.getLatLng() : ENCOUNTER_MAP.getCenter(),
						zoom: ENCOUNTER_MAP.getZoom()
					}
					
					// Record field values
					currentStorage.fieldValues = {...FIELD_VALUES};
					
					// Save
					window.localStorage[pageName] = JSON.stringify(currentStorage);
				}
			});

			// Get username and store for INSERTing data
			$.ajax({
				url: 'bhims.php',
				method: 'POST',
				data: {action: 'getUser'},
				cache: false
			}).done(function(resultString) {
					resultString = resultString.trim();
					if (resultString)  {
								USERNAME = resultString.toLowerCase();
					} else {
						console.log('username query failed. result: ' + resultString)
					}
			});

			// Get coordinates for BC units and place names
			queryDB(`SELECT code, latitude, longitude FROM backcountry_unit_codes WHERE sort_order IS NOT NULL AND latitude IS NOT NULL AND longitude IS NOT NULL;`)
				.then(
					doneFilter=function(queryResultString){
						if (queryResultString.startsWith('ERROR') || queryResultString === '["query returned an empty result"]') {
							throw 'Backcountry unit coordinates query failed: ' + queryResultString;
						} else {
							const queryResult = $.parseJSON(queryResultString);
							queryResult.forEach(function(object) {
								BACKCOUNTRY_UNIT_COORDINATES[object.code] = {lat: object.latitude, lon: object.longitude};
							})
						}
					},
					failFilter=function(xhr, status, error) {
						console.log(`Backcountry unit coordinates query failed with status ${status} because ${error}`)
					}
				);
			queryDB(`SELECT code, latitude, longitude FROM place_name_codes WHERE sort_order IS NOT NULL AND latitude IS NOT NULL AND longitude IS NOT NULL;`)
				.then(
					doneFilter=function(queryResultString){
						if (queryResultString.startsWith('ERROR') || queryResultString === '["query returned an empty result"]') {
							throw 'Backcountry unit coordinates query failed: ' + queryResultString;
						} else {
							const queryResult = $.parseJSON(queryResultString);
							queryResult.forEach(function(object) {
								PLACE_NAME_COORDINATES[object.code] = {lat: object.latitude, lon: object.longitude};
							})
						}
					},
					failFilter=function(xhr, status, error) {
						console.log(`Backcountry unit coordinates query failed with status ${status} because ${error}`)
					}
				);

			// When bear species, color, or cohort gets filled, add appropriate number 
			//	of cards to the hidden accordion
			$('.dena-bear-field').change(onDENABearFieldChange);
		
		});


	</script>

</body>



</html>